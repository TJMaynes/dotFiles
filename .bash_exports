#!/bin/bash

setup_secrets() {
  [[ -f "$HOME/.bash_secrets" ]] && source $HOME/.bash_secrets
}

setup_exports() {
  export LANG=en_US.UTF-8
  export EDITOR=vi
  export PATH=/usr/local/bin:$PATH
  export GPG_TTY=$(tty)

  export WORKSPACE_DIRECTORY=$HOME/workspace
  export GIT_USERNAME=tjmaynes

  if [ $TERM = 'dumb' ]; then
    export PS1="\n\w\n\u $"
  else
    export TERM="xterm-256color"
  fi
}

setup_aliases() {
  alias psx='ps -x'
  alias create-ssh-key='ssh-keygen -t rsa -b 4096 -C'
  alias gen-pass='openssl rand -base64 25 | tr -d /'
  alias port-usage='sudo lsof -i -P -n | grep LISTEN'
  alias k='kubectl'
  alias kgp='k get pods'
  alias kgd='k get deployments'

  if [[ "$OSTYPE" == "linux-gnu"* ]]; then
    alias pbcopy='xclip -selection clipboard'
    alias pbpaste='xclip -selection clipboard -o'

    alias running-services='systemctl list-units  --type=service  --state=running'
  fi
}

setup_jvm() {
  export JAVA_VERSION=16.0.0-zulu
  export LEININGEN_VERSION=2.9.5
  export SDKMAN_DIR="$HOME/.sdkman"

  install_jvm_package java java "$JAVA_VERSION"
  install_jvm_package leiningen lein "$LEININGEN_VERSION"
}

setup_node() {
  export NODE_VERSION=15.14.0

  install_runtime nodenv $NODE_VERSION

  install_node_package yarn yarn
  install_node_package create-react-app create-react-app
}

setup_python() {
  export PYTHON_VERSION=3.9.1
  export PYTHON_CONFIGURE_OPTS="--enable-shared"

  install_runtime pyenv $PYTHON_VERSION

  install_python_package pip true
  (pip install --upgrade pip || true) >/dev/null

  install_python_package cookiecutter true
}

setup_runtimes() {
  setup_jvm
  setup_node
  setup_python
}

main() {
  source $HOME/.bash_common

  setup_secrets
  setup_exports
  setup_aliases
  setup_runtimes
}

main
