#!/bin/sh

setup_secrets() {
  [[ -f "$HOME/.bash_secrets" ]] && source $HOME/.bash_secrets
}

setup_exports() {
  export LANG=en_US.UTF-8
  export EDITOR=vi
  export PATH=/usr/local/bin:$PATH
  export GPG_TTY=$(tty)

  export WORKSPACE_DIRECTORY=$HOME/workspace
  export GIT_USERNAME=tjmaynes

  if [ $TERM = 'dumb' ]; then
    export PS1="\n\w\n\u $"
  else
    export TERM="xterm-256color"
    export PS1="\n\u in \w\$(git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/ (\1)/')\n=> \[$(tput sgr0)\]"
  fi
}

setup_aliases() {
  alias psx='ps -x'
  alias create-ssh-key='ssh-keygen -t rsa -b 4096 -C'
  alias gen-pass='openssl rand -base64 25 | tr -d /'
  alias port-usage='sudo lsof -i -P -n | grep LISTEN'
  alias k='kubectl'
  alias kgp='k get pods'
  alias kgd='k get deployments'

  if [[ "$OSTYPE" == "linux-gnu"* ]]; then
    alias pbcopy='xclip -selection clipboard'
    alias pbpaste='xclip -selection clipboard -o'

    alias running-services='systemctl list-units  --type=service  --state=running'
  fi
}

setup_node() {
  export NODE_VERSION=14.15.3
  export PATH="$HOME/.nodenv/bin:$PATH"
  export PATH="$HOME/.nodenv/shims:$PATH"

  initialize_tool nodenv 

  install_runtime nodenv $NODE_VERSION

  install_node_package yarn
  install_node_package create-react-app
}

setup_python() {
  export PYTHON_VERSION=3.8.0
  export PYTHON_CONFIGURE_OPTS="--enable-shared"
  export PATH="$HOME/.pyenv/bin:$PATH"
  export PATH="$HOME/.pyenv/shims:$PATH"

  initialize_tool pyenv

  install_runtime pyenv $PYTHON_VERSION

  install_python_package pip
  install_python_package pylint 
  install_python_package cookiecutter
  install_python_package jupyter
}

setup_jvm() {
  export JAVA_VERSION=13.0.2.j9-adpt
  export KOTLIN_VERSION=1.3.61
  export SDKMAN_DIR="$HOME/.sdkman"
  [[ -s "$HOME/.sdkman/bin/sdkman-init.sh" ]] && source "$HOME/.sdkman/bin/sdkman-init.sh"

  install_jvm_package java $JAVA_VERSION
  install_jvm_package kotlin $KOTLIN_VERSION
}

setup_runtimes() {
  setup_node
  setup_python
  setup_jvm
}

main() {
  source $HOME/.bash_common

  setup_secrets
  setup_exports
  setup_aliases
  setup_runtimes
}

main
